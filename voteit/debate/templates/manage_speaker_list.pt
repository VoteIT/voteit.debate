<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="load: ${api.template_dir}main.pt"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="voteit.debate">
<body>

    <tal:main metal:fill-slot="main_window">
        <div class="columns">
            <div class="wrapper">
                <div class="section">
                    <!-- FIXME: Limit to context_active might not be what we want. Editing other inactive lists is a good idea -->
                    <div id="left">
                        <tal:not_active condition="not context_active">
                            <h3 i18n:translate="">(Activate list to show controls)</h3>
                        </tal:not_active>
                        <div id="speaker_controlbox" tal:condition="context_active">
                            <a id="start_speaker">
                                <img src="/debate_static/img/speaker_controls_play.png" title="Start" i18n:attributes="title" />
                            </a>
                            <a id="pause_speaker">
                                <img src="/debate_static/img/speaker_controls_pause.png" title="Pause" i18n:attributes="title" />
                            </a>
                            <a id="finished_speaker">
                                <img src="/debate_static/img/speaker_controls_stop.png" title="Finished" i18n:attributes="title" />
                            </a>
                            <a id="quickstart_next_speaker">
                                <img src="/debate_static/img/speaker_controls_next.png" title="Quickstart next" i18n:attributes="title" />
                            </a>
                            <a href="${request.resource_url(context, 'speaker_list_action', query = {'name': active_list.name, 'action': 'undo'})}" id="speaker_undo">
                                <img src="/debate_static/img/speaker_controls_undo.png" title="Undo start" i18n:attributes="title" />
                            </a>
                            <a href="${request.resource_url(context, 'speaker_list_action', query = {'name': active_list.name, 'action': 'shuffle'})}" id="shuffle_speakers">
                                <img src="/debate_static/img/speaker_controls_shuffle.png" title="Shuffle queue" i18n:attributes="title" />
                            </a>
                            <div class="clear"><!-- --></div>

                            <tal:form replace="structure add_form">Participant number add form</tal:form>
                            <div class="clear"><!-- --></div>
                        </div>


                        <ul id="speaker_active" class="speaker_queue">
                            <li tal:condition="context_active and active_list.current != None" tal:replace="structure speaker_item(active_list.current)" />
                        </ul>
                        <ul id="speaker_queue" class="speaker_queue"></ul>
                    </div>
                    <div id="right">
                        <ul id="speaker_list_controls">
                            <li tal:repeat="sl context_lists"
                                tal:attributes="class (active_list and sl.name == active_list.name) and 'selected' or ''">
                                <span class="action_menu dropdown_menu cogwheel">
                                    <a class="menu_header" href="#">Moderatorsmeny</a>
                                    <ul class="menu_body">
                                        <li>
                                            <a href="${request.resource_url(context, 'speaker_list_action', query = {'action': 'set_state', 'name': sl.name, 'state': 'closed'})}"
                                               class="list_state" tal:condition="sl.state != u'closed'" i18n:translate="">Close list</a>
                                            <a href="${request.resource_url(context, 'speaker_list_action', query = {'action': 'set_state', 'name': sl.name, 'state': 'open'})}"
                                               class="list_state" tal:condition="sl.state != u'open'" i18n:translate="">Open list</a>
                                        </li>
                                        <li>
                                            <a href="${request.resource_url(context, 'speaker_list_action', query = {'action': 'remove', 'name': sl.name})}"
                                               i18n:translate="">Delete</a>
                                        </li>
                                    </ul>
                                </span>
                                <a class="editpen rename_sl" title="rename" i18n:attributes="title"
                                   href="javascript:">&nbsp;</a>
                                <a href="${request.resource_url(context, 'speaker_list_action', query = {'action': 'set', 'name': sl.name})}"
                                   class="sl_title">
                                   <span tal:attributes="class sl.state == 'open' and 'iconpadding icon ongoing' or 'iconpadding icon closed'">
                                   ${sl.title}
                                   </span>
                                </a>
                                <form action="${request.resource_url(context, 'speaker_list_action', query = {'action': 'rename', 'name': sl.name})}"
                                    method="GET" class="rename_form" style="display: none;">
                                    <input name="list_title_rename" value="${sl.title}" />
                                </form>
                                <div class="clear"><!-- --></div>
                            </li>
                        </ul>
                        <a href="${request.resource_url(context, 'speaker_list_action', query = {'action': 'add'})}"
                           class="buttonize small" i18n:translate="">New list</a>
                        <div class="clear"><!-- --></div>

                        <h3 i18n:translate="">Speaker log</h3>
                        <ul id="speaker_log"></ul>
                        <a href="${request.resource_url(context, 'speaker_list_action', query = {'action': 'clear', 'name': active_list.name})}"
                           tal:condition="context_active" class="buttonize small" id="clear_speaker_log" i18n:translate="">Clear</a>
                    </div>

                </div><!-- section -->
            </div>
        </div>
        <script language="javascript" type="text/javascript">
            $(document).ready(function () {
                //Bind events
                $(".rename_sl").live("click", rename_speaker_show);
                $(".rename_form").on("submit", rename_speaker_submit);
            });
        </script>
        <script language="javascript" type="text/javascript" tal:condition="context_active">
            $(document).ready(function () {
                active_list_action_url = "${request.resource_url(api.meeting, 'speaker_action', query = {'list_name': active_list.name})}";
                reload_interval = ${api.meeting.get_field_value('reload_manager_interface', 4) * 1000}; //seconds -> miliseconds! - make sure it's global
                //Load templates
                load_speaker_queue();
                load_speaker_log();
                //Bind events to controls
                $("#start_speaker").on("click", start_speaker);
                $("#pause_speaker").on("click", pause_speaker);
                $("#finished_speaker").on("click", finished_speaker);
                $("#quickstart_next_speaker").on("click", quickstart_next_speaker);
                $("#speaker_undo").on("click", speaker_undo);
                $("#shuffle_speakers").on("click", shuffle_speakers);
                $("form#add_speaker").on("submit", add_speaker);
                $("#clear_speaker_log").on("click", clear_speaker_log);
                //Focus
                $("name=[pn]").focus();
            });
        </script>
    </tal:main>

</body>
</html>
